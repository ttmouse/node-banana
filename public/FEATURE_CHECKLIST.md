# Node Banana - å®˜æ–¹åŠŸèƒ½æ–‡æ¡£

> **Node Banana** æ˜¯ä¸€ä¸ªåŸºäºèŠ‚ç‚¹çš„å¯è§†åŒ–å·¥ä½œæµç¼–è¾‘å™¨ï¼Œç”¨äº AI å›¾åƒç”Ÿæˆå’Œå¤„ç†ã€‚
>
> **æ–‡æ¡£ç”¨é€”**:
> - ğŸ“– å®˜æ–¹åŠŸèƒ½ä»‹ç»å’Œæ“ä½œæŒ‡å—
> - ğŸ”§ å¼€å‘å‚è€ƒæ–‡æ¡£ï¼ˆä¿®æ”¹ä»£ç æ—¶é˜²æ­¢ç ´åç°æœ‰åŠŸèƒ½ï¼‰
> - ğŸ¤– AI è¾…åŠ©å¼€å‘çš„ä¸Šä¸‹æ–‡å‚è€ƒ
>
> **æœ€åæ›´æ–°**: 2025-12-26

---

## ğŸ“š ç›®å½•

1. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
2. [èŠ‚ç‚¹ç³»ç»Ÿ](#èŠ‚ç‚¹ç³»ç»Ÿ)
3. [è¿æ¥ç³»ç»Ÿ](#è¿æ¥ç³»ç»Ÿ)
4. [ç”»å¸ƒäº¤äº’](#ç”»å¸ƒäº¤äº’)
5. [å·¥ä½œæµæ‰§è¡Œ](#å·¥ä½œæµæ‰§è¡Œ)
6. [æ–‡ä»¶ç®¡ç†](#æ–‡ä»¶ç®¡ç†)
7. [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
8. [é”®ç›˜å¿«æ·é”®](#é”®ç›˜å¿«æ·é”®)
9. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)

---

## æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯èŠ‚ç‚¹å·¥ä½œæµï¼Ÿ

Node Banana ä½¿ç”¨**èŠ‚ç‚¹**å’Œ**è¿æ¥**æ¥æ„å»º AI å›¾åƒç”Ÿæˆæµç¨‹ï¼š

- **èŠ‚ç‚¹ (Node)**: ä»£è¡¨ä¸€ä¸ªåŠŸèƒ½å•å…ƒï¼ˆè¾“å…¥å›¾ç‰‡ã€ç”Ÿæˆæç¤ºè¯ã€AI ç”Ÿæˆç­‰ï¼‰
- **è¿æ¥ (Edge)**: èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®æµåŠ¨ï¼Œä¼ é€’å›¾ç‰‡æˆ–æ–‡æœ¬
- **å·¥ä½œæµ (Workflow)**: ç”±å¤šä¸ªèŠ‚ç‚¹å’Œè¿æ¥ç»„æˆçš„å®Œæ•´å¤„ç†æµç¨‹

### æ•°æ®ç±»å‹ç³»ç»Ÿ

èŠ‚ç‚¹é€šè¿‡**å¥æŸ„ (Handle)** è¿›è¡Œè¿æ¥ï¼Œæ¯ä¸ªå¥æŸ„æœ‰ç‰¹å®šçš„æ•°æ®ç±»å‹ï¼š

| ç±»å‹ | é¢œè‰² | æ•°æ®æ ¼å¼ | ç”¨é€” |
|------|------|----------|------|
| `image` | ğŸŸ¢ ç»¿è‰² | Base64 Data URL | ä¼ é€’å›¾ç‰‡æ•°æ®ï¼ˆç…§ç‰‡ã€ç”Ÿæˆå›¾ã€æ ‡æ³¨å›¾ï¼‰ |
| `text` | ğŸ”µ è“è‰² | String | ä¼ é€’æ–‡æœ¬æ•°æ®ï¼ˆæç¤ºè¯ã€LLM è¾“å‡ºï¼‰ |
| `reference` | âšª ç°è‰² | è™šæ‹Ÿè¿æ¥ | è¡¨ç¤ºä¾èµ–å…³ç³»ï¼Œä¸ä¼ é€’å®é™…æ•°æ® |

**ç±»å‹åŒ¹é…è§„åˆ™**:
- âœ… `image` â†” `image` å¯ä»¥è¿æ¥
- âœ… `text` â†” `text` å¯ä»¥è¿æ¥
- âŒ `image` â†” `text` æ— æ³•è¿æ¥ï¼ˆç±»å‹ä¸åŒ¹é…ï¼‰

---

## èŠ‚ç‚¹ç³»ç»Ÿ

### 1. Image Input èŠ‚ç‚¹ (å›¾ç‰‡è¾“å…¥)

**ä½œç”¨**: åŠ è½½æœ¬åœ°å›¾ç‰‡åˆ°å·¥ä½œæµä¸­

**ä½ç½®**: `src/components/nodes/ImageInputNode.tsx`

**åˆ›å»ºæ–¹å¼**:
- å¿«æ·é”®: `Shift + I`
- ä» Action Bar æ‹–æ‹½
- æ‹–æ‹½å›¾ç‰‡æ–‡ä»¶åˆ°ç”»å¸ƒè‡ªåŠ¨åˆ›å»º
- ç²˜è´´å‰ªè´´æ¿å›¾ç‰‡ (`Cmd/Ctrl + V`)

**åŠŸèƒ½ç‰¹æ€§**:
- ğŸ“ æ”¯æŒåŠ è½½æœ¬åœ°å›¾ç‰‡ï¼ˆç‚¹å‡» "Load Image"ï¼‰
- ğŸ“‹ æ”¯æŒä»å‰ªè´´æ¿ç²˜è´´å›¾ç‰‡
- ğŸ–¼ï¸ æ˜¾ç¤ºå›¾ç‰‡ç¼©ç•¥å›¾å’Œå°ºå¯¸ä¿¡æ¯
- ğŸ” ç‚¹å‡»å›¾ç‰‡å¯æŸ¥çœ‹åŸå›¾
- ğŸ’¾ å›¾ç‰‡æ•°æ®è‡ªåŠ¨ç¼“å­˜åˆ° IndexedDB

**è¾“å‡º**:
- ğŸŸ¢ `image` å¥æŸ„ - è¾“å‡ºåŠ è½½çš„å›¾ç‰‡

**ä½¿ç”¨åœºæ™¯**:
- ä½œä¸ºå·¥ä½œæµçš„èµ·ç‚¹ï¼Œæä¾›åŸå§‹å›¾ç‰‡
- å¯¼å…¥å‚è€ƒå›¾ç‰‡ç”¨äº AI ç”Ÿæˆ
- å¯¼å…¥éœ€è¦æ ‡æ³¨çš„å›¾ç‰‡

**é»˜è®¤å°ºå¯¸**: 300 Ã— 280 px

---

### 2. Prompt èŠ‚ç‚¹ (æç¤ºè¯è¾“å…¥)

**ä½œç”¨**: è¾“å…¥æ–‡æœ¬æç¤ºè¯ï¼Œç”¨äº AI ç”Ÿæˆ

**ä½ç½®**: `src/components/nodes/PromptNode.tsx`

**åˆ›å»ºæ–¹å¼**:
- å¿«æ·é”®: `Shift + P`
- ä» Action Bar æ‹–æ‹½
- ç²˜è´´å‰ªè´´æ¿æ–‡æœ¬ (`Cmd/Ctrl + V`)

**åŠŸèƒ½ç‰¹æ€§**:
- âœï¸ å¤šè¡Œæ–‡æœ¬è¾“å…¥æ¡†
- ğŸ’¾ è‡ªåŠ¨ä¿å­˜è¾“å…¥å†…å®¹
- ğŸ“‹ æ”¯æŒç²˜è´´é•¿æ–‡æœ¬

**è¾“å‡º**:
- ğŸ”µ `text` å¥æŸ„ - è¾“å‡ºè¾“å…¥çš„æ–‡æœ¬

**ä½¿ç”¨åœºæ™¯**:
- ä¸º Nano Banana èŠ‚ç‚¹æä¾›ç”Ÿæˆæç¤ºè¯
- ä¸º LLM Generate èŠ‚ç‚¹æä¾›è¾“å…¥
- å­˜å‚¨å’Œç®¡ç†å¸¸ç”¨æç¤ºè¯

**é»˜è®¤å°ºå¯¸**: 320 Ã— 220 px

---

### 3. Nano Banana èŠ‚ç‚¹ (AI å›¾ç‰‡ç”Ÿæˆ)

**ä½œç”¨**: ä½¿ç”¨ Google Gemini API ç”Ÿæˆå›¾ç‰‡

**ä½ç½®**: `src/components/nodes/NanoBananaNode.tsx`

**åˆ›å»ºæ–¹å¼**:
- å¿«æ·é”®: `Shift + G`
- ä» Action Bar æ‹–æ‹½
- ä»æ–‡æœ¬å¥æŸ„æ‹–æ‹½åˆ°ç©ºç™½å¤„åˆ›å»ºå¹¶è‡ªåŠ¨è¿æ¥

**è¾“å…¥**:
- ğŸ”µ `text` å¥æŸ„ - **å¿…éœ€**ï¼Œç”Ÿæˆæç¤ºè¯
- ğŸŸ¢ `image` å¥æŸ„ - å¯é€‰ï¼Œå‚è€ƒå›¾ç‰‡ï¼ˆæ”¯æŒå¤šå›¾è¿æ¥ï¼‰

**è¾“å‡º**:
- ğŸŸ¢ `image` å¥æŸ„ - ç”Ÿæˆçš„å›¾ç‰‡

**ç”Ÿæˆå‚æ•°**:

| å‚æ•° | é€‰é¡¹ | è¯´æ˜ |
|------|------|------|
| **Aspect Ratio** | 1:1, 16:9, 9:16, 4:3, 3:4 | å›¾ç‰‡å®½é«˜æ¯” |
| **Resolution** | 1K, 2K | å›¾ç‰‡åˆ†è¾¨ç‡ |
| **Model** | nano-banana, nano-banana-pro | ç”Ÿæˆæ¨¡å‹ |
| **Google Search** | å¼€/å…³ | æ˜¯å¦ä½¿ç”¨ç½‘ç»œæœç´¢å¢å¼º |

**æ“ä½œæµç¨‹**:
1. è¿æ¥ Prompt èŠ‚ç‚¹æä¾›æ–‡æœ¬
2. ï¼ˆå¯é€‰ï¼‰è¿æ¥ Image Input èŠ‚ç‚¹æä¾›å‚è€ƒå›¾
3. è°ƒæ•´ç”Ÿæˆå‚æ•°
4. ç‚¹å‡» "Generate" æˆ–è¿è¡Œå·¥ä½œæµ
5. ç­‰å¾…ç”Ÿæˆå®Œæˆï¼ˆæ˜¾ç¤º "Generating..." çŠ¶æ€ï¼‰
6. ç”Ÿæˆçš„å›¾ç‰‡è‡ªåŠ¨ä¿å­˜åˆ°å…¨å±€å†å²è®°å½•

**å†ç”ŸæˆåŠŸèƒ½**:
- ç‚¹å‡»èŠ‚ç‚¹ä¸Šçš„åˆ·æ–°æŒ‰é’® ğŸ”„
- ä½¿ç”¨ç›¸åŒå‚æ•°é‡æ–°ç”Ÿæˆ
- é€‚ç”¨äºéœ€è¦å¤šæ¬¡å°è¯•çš„åœºæ™¯

**çŠ¶æ€æŒ‡ç¤º**:
- âšª `idle` - å°±ç»ª
- ğŸ”µ `loading` - ç”Ÿæˆä¸­ï¼ˆè“è‰²è¾¹æ¡† + åŠ è½½åŠ¨ç”»ï¼‰
- âœ… `complete` - å®Œæˆ
- âŒ `error` - é”™è¯¯ï¼ˆæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼‰

**é»˜è®¤å°ºå¯¸**: 300 Ã— 300 px

**API å®ç°**: `/api/generate`

---

### 4. Annotation èŠ‚ç‚¹ (å›¾ç‰‡æ ‡æ³¨)

**ä½œç”¨**: åœ¨å›¾ç‰‡ä¸Šæ·»åŠ çŸ©å½¢æ¡†å’Œæ–‡å­—æ ‡ç­¾

**ä½ç½®**: `src/components/nodes/AnnotationNode.tsx`

**åˆ›å»ºæ–¹å¼**:
- å¿«æ·é”®: `Shift + A`
- ä» Action Bar æ‹–æ‹½
- ä»å›¾ç‰‡å¥æŸ„æ‹–æ‹½åˆ°ç©ºç™½å¤„åˆ›å»ºå¹¶è‡ªåŠ¨è¿æ¥

**è¾“å…¥**:
- ğŸŸ¢ `image` å¥æŸ„ - éœ€è¦æ ‡æ³¨çš„å›¾ç‰‡

**è¾“å‡º**:
- ğŸŸ¢ `image` å¥æŸ„ - å¸¦æ ‡æ³¨çš„å›¾ç‰‡

**æ ‡æ³¨åŠŸèƒ½**:
1. ç‚¹å‡» "Annotate" æ‰“å¼€æ ‡æ³¨ç¼–è¾‘å™¨
2. åœ¨å›¾ç‰‡ä¸Š**æ‹–æ‹½é¼ æ ‡**ç»˜åˆ¶çŸ©å½¢æ¡†
3. **åŒå‡»çŸ©å½¢æ¡†**ç¼–è¾‘æ ‡ç­¾æ–‡å­—
4. ç‚¹å‡» "Save" ä¿å­˜æ ‡æ³¨
5. å¸¦æ ‡æ³¨çš„å›¾ç‰‡ä¿å­˜åˆ°èŠ‚ç‚¹è¾“å‡º

**æ ‡æ³¨æ“ä½œ**:
- â• **ç»˜åˆ¶æ¡†**: æ‹–æ‹½é¼ æ ‡
- âœï¸ **ç¼–è¾‘æ ‡ç­¾**: åŒå‡»çŸ©å½¢æ¡†
- ğŸ—‘ï¸ **åˆ é™¤æ ‡æ³¨**: ç‚¹å‡»æ ‡æ³¨å³ä¸Šè§’çš„åˆ é™¤æŒ‰é’®
- ğŸ¨ **é¢œè‰²**: è‡ªåŠ¨ä¸ºæ¯ä¸ªæ ‡æ³¨åˆ†é…ä¸åŒé¢œè‰²

**ä½¿ç”¨åœºæ™¯**:
- ç›®æ ‡æ£€æµ‹æ•°æ®æ ‡æ³¨
- å›¾ç‰‡åŒºåŸŸæ ‡è®°
- è§†è§‰æŒ‡å¼•å’Œè¯´æ˜

**é»˜è®¤å°ºå¯¸**: 300 Ã— 280 px

**å®ç°**: åŸºäº Konva.js ç”»å¸ƒåº“

---

### 5. LLM Generate èŠ‚ç‚¹ (æ–‡æœ¬ç”Ÿæˆ)

**ä½œç”¨**: ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆæ–‡æœ¬

**ä½ç½®**: `src/components/nodes/LLMGenerateNode.tsx`

**åˆ›å»ºæ–¹å¼**:
- å¿«æ·é”®: `Shift + L`
- ä» Action Bar æ‹–æ‹½

**è¾“å…¥**:
- ğŸ”µ `text` å¥æŸ„ - **å¿…éœ€**ï¼Œè¾“å…¥æç¤ºè¯
- ğŸŸ¢ `image` å¥æŸ„ - å¯é€‰ï¼Œç”¨äºè§†è§‰ç†è§£ï¼ˆå¤šæ¨¡æ€æ¨¡å‹ï¼‰

**è¾“å‡º**:
- ğŸ”µ `text` å¥æŸ„ - ç”Ÿæˆçš„æ–‡æœ¬

**æ¨¡å‹é…ç½®**:

| å‚æ•° | é€‰é¡¹ | è¯´æ˜ |
|------|------|------|
| **Provider** | Google, OpenAI, Anthropic | æ¨¡å‹æä¾›å•† |
| **Model** | æ ¹æ® Provider æ˜¾ç¤º | å…·ä½“æ¨¡å‹é€‰æ‹© |
| **Temperature** | 0.0 - 2.0 | åˆ›é€ æ€§ï¼ˆè¶Šé«˜è¶Šéšæœºï¼‰ |
| **Max Tokens** | æ•°å­— | æœ€å¤§ç”Ÿæˆé•¿åº¦ |

**æ“ä½œæµç¨‹**:
1. è¿æ¥æ–‡æœ¬è¾“å…¥
2. é€‰æ‹©æ¨¡å‹å’Œå‚æ•°
3. ç‚¹å‡» "Generate" æˆ–è¿è¡Œå·¥ä½œæµ
4. æŸ¥çœ‹ç”Ÿæˆç»“æœ
5. ç‚¹å‡» "Copy" å¤åˆ¶è¾“å‡ºæ–‡æœ¬

**ä½¿ç”¨åœºæ™¯**:
- æç¤ºè¯æ‰©å±•å’Œä¼˜åŒ–
- å›¾ç‰‡æè¿°ç”Ÿæˆï¼ˆé…åˆå›¾ç‰‡è¾“å…¥ï¼‰
- æ–‡æœ¬è½¬æ¢å’Œæ”¹å†™

**é»˜è®¤å°ºå¯¸**: 320 Ã— 360 px

**API å®ç°**: `/api/llm`

---

### 6. Split Grid èŠ‚ç‚¹ (ç½‘æ ¼åˆ†å‰²)

**ä½œç”¨**: è‡ªåŠ¨æ£€æµ‹å¹¶åˆ†å‰²ç½‘æ ¼å¸ƒå±€çš„å›¾ç‰‡ï¼Œæ‰¹é‡ç”Ÿæˆæ–°å›¾ç‰‡

**ä½ç½®**: `src/components/nodes/SplitGridNode.tsx`

**åˆ›å»ºæ–¹å¼**:
- ä» Action Bar æ‹–æ‹½

**è¾“å…¥**:
- ğŸŸ¢ `image` å¥æŸ„ - åŒ…å«ç½‘æ ¼çš„æºå›¾ç‰‡

**è¾“å‡º**:
- âšª `reference` å¥æŸ„ - è™šæ‹Ÿè¿æ¥ï¼Œä¸ä¼ é€’æ•°æ®

**é…ç½®å‚æ•°**:

ç‚¹å‡» "Configure" æ‰“å¼€è®¾ç½®é¢æ¿ï¼š

| å‚æ•° | è¯´æ˜ |
|------|------|
| **Target Count** | ç›®æ ‡å›¾ç‰‡æ•°é‡ï¼ˆè‡ªåŠ¨è®¡ç®—è¡Œåˆ—ï¼‰ |
| **Grid Rows** | æ‰‹åŠ¨æŒ‡å®šè¡Œæ•° |
| **Grid Cols** | æ‰‹åŠ¨æŒ‡å®šåˆ—æ•° |
| **Default Prompt** | å­èŠ‚ç‚¹çš„é»˜è®¤æç¤ºè¯ |
| **Generate Settings** | å­èŠ‚ç‚¹çš„ç”Ÿæˆå‚æ•°ï¼ˆAspect Ratio, Model ç­‰ï¼‰ |

**å·¥ä½œæµç¨‹**:
1. è¿æ¥åŒ…å«ç½‘æ ¼çš„æºå›¾ç‰‡
2. é…ç½®åˆ†å‰²å‚æ•°
3. è¿è¡Œå·¥ä½œæµ
4. è‡ªåŠ¨åˆ›å»ºä»¥ä¸‹èŠ‚ç‚¹ï¼š
   - **ImageInput èŠ‚ç‚¹**: å­˜å‚¨åˆ†å‰²åçš„å•ä¸ªå›¾ç‰‡
   - **Prompt èŠ‚ç‚¹**: å­˜å‚¨é»˜è®¤æç¤ºè¯
   - **NanoBanana èŠ‚ç‚¹**: ç”¨äºå†ç”Ÿæˆ
5. è‡ªåŠ¨å»ºç«‹èŠ‚ç‚¹é—´çš„è¿æ¥å…³ç³»
6. èŠ‚ç‚¹æŒ‰ç½‘æ ¼å¸ƒå±€æ’åˆ—

**ä½¿ç”¨åœºæ™¯**:
- æ‰¹é‡å¤„ç†ç½‘æ ¼æˆªå›¾
- æ¸¸æˆè§’è‰²å¡ç‰‡ç”Ÿæˆ
- å•†å“å›¾æ‰¹é‡å¤„ç†

**é»˜è®¤å°ºå¯¸**: 300 Ã— 320 px

**æŠ€æœ¯å®ç°**:
- ç½‘æ ¼æ£€æµ‹: `src/utils/gridSplitter.ts`
- ä½¿ç”¨ Canvas API åˆ†å‰²å›¾ç‰‡

---

### 7. Output èŠ‚ç‚¹ (è¾“å‡ºå±•ç¤º)

**ä½œç”¨**: å±•ç¤ºæœ€ç»ˆç»“æœå¹¶æ”¯æŒä¸‹è½½

**ä½ç½®**: `src/components/nodes/OutputNode.tsx`

**åˆ›å»ºæ–¹å¼**:
- ä» Action Bar æ‹–æ‹½

**è¾“å…¥**:
- ğŸŸ¢ `image` å¥æŸ„ - è¦è¾“å‡ºçš„å›¾ç‰‡

**åŠŸèƒ½ç‰¹æ€§**:
- ğŸ–¼ï¸ æ˜¾ç¤ºæœ€ç»ˆç”Ÿæˆçš„å›¾ç‰‡
- ğŸ’¾ ä¸‹è½½åŠŸèƒ½ï¼ˆç‚¹å‡» "Download"ï¼‰
- ğŸ“‚ æ–‡ä»¶åæ ¼å¼: `output-{timestamp}.png`
- ğŸ” ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹å¤§å›¾

**ä½¿ç”¨åœºæ™¯**:
- æ ‡è®°å·¥ä½œæµçš„ç»ˆç‚¹
- ä¸‹è½½æœ€ç»ˆç»“æœ
- å¿«é€Ÿé¢„è§ˆå’Œå¯¼å‡º

**é»˜è®¤å°ºå¯¸**: 320 Ã— 320 px

---

## è¿æ¥ç³»ç»Ÿ

### è¿æ¥çš„åˆ›å»º

**æ–¹å¼ 1: ç›´æ¥æ‹–æ‹½è¿æ¥**
1. ä»èŠ‚ç‚¹çš„è¾“å‡ºå¥æŸ„æ‹–æ‹½åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹çš„è¾“å…¥å¥æŸ„
2. æˆ–åå‘ï¼šä»è¾“å…¥å¥æŸ„æ‹–åˆ°è¾“å‡ºå¥æŸ„
3. ç±»å‹åŒ¹é…æ—¶æ˜¾ç¤ºè¿æ¥çº¿

**æ–¹å¼ 2: æ‹–æ‹½åˆ°ç©ºç™½å¤„ï¼ˆå¿«é€Ÿåˆ›å»ºèŠ‚ç‚¹ï¼‰**
1. ä»å¥æŸ„æ‹–æ‹½åˆ°ç”»å¸ƒç©ºç™½åŒºåŸŸ
2. å¼¹å‡º **Connection Drop Menu**
3. é€‰æ‹©è¦åˆ›å»ºçš„èŠ‚ç‚¹ç±»å‹
4. è‡ªåŠ¨åˆ›å»ºèŠ‚ç‚¹å¹¶å»ºç«‹è¿æ¥

**æ–¹å¼ 3: æ‹–æ‹½åˆ°èŠ‚ç‚¹ä¸Šï¼ˆæ™ºèƒ½è¿æ¥ï¼‰**
1. ä»å¥æŸ„æ‹–æ‹½åˆ°ç›®æ ‡èŠ‚ç‚¹ä¸Š
2. ç³»ç»Ÿè‡ªåŠ¨å¯»æ‰¾å…¼å®¹çš„å¥æŸ„
3. è‡ªåŠ¨å»ºç«‹è¿æ¥ï¼ˆå¦‚æœç±»å‹åŒ¹é…ï¼‰

**æ‰¹é‡è¿æ¥**:
1. é€‰ä¸­å¤šä¸ªèŠ‚ç‚¹ï¼ˆShift + ç‚¹å‡»ï¼‰
2. ä»å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹æ‹–æ‹½è¿æ¥
3. æ‰€æœ‰é€‰ä¸­èŠ‚ç‚¹åŒæ—¶å»ºç«‹ç›¸åŒè¿æ¥
4. é€‚ç”¨äºæ‰¹é‡å¤„ç†åœºæ™¯

**ä½ç½®**: `src/components/WorkflowCanvas.tsx` - `handleConnect()`

---

### è¿æ¥çš„ç±»å‹

#### Editable Edge (å¯ç¼–è¾‘è¾¹)
**é»˜è®¤è¿æ¥ç±»å‹**

**ç‰¹æ€§**:
- å¹³æ»‘æ›²çº¿æˆ–ç›´è§’è¿æ¥ï¼ˆå¯åœ¨è®¾ç½®ä¸­åˆ‡æ¢ï¼‰
- é¼ æ ‡æ‚¬åœæ˜¾ç¤ºå·¥å…·æ 
- å¯é€‰ä¸­ï¼ˆé»„è‰²é«˜äº®ï¼‰
- æ”¯æŒæš‚åœæ ‡è®°

**æ“ä½œ**:
- ç‚¹å‡»é€‰ä¸­
- åˆ é™¤: é€‰ä¸­åæŒ‰ `Backspace` / `Delete`
- æ ‡è®°æš‚åœ: ç‚¹å‡» Edge Toolbar çš„æš‚åœå›¾æ ‡

**å®ç°**: `src/components/edges/EditableEdge.tsx`

#### Reference Edge (å¼•ç”¨è¾¹)
**è™šæ‹Ÿè¿æ¥ç±»å‹**

**ç‰¹æ€§**:
- ç°è‰²è™šçº¿æ ·å¼
- ä»…è¡¨ç¤ºä¾èµ–å…³ç³»
- ä¸ä¼ é€’å®é™…æ•°æ®
- ä¸å¯ç¼–è¾‘

**ç”¨é€”**:
- Split Grid èŠ‚ç‚¹çš„è¾“å‡ºè¿æ¥
- è¡¨ç¤ºæ‰§è¡Œé¡ºåºä¾èµ–

**å®ç°**: `src/components/edges/ReferenceEdge.tsx`

---

### è¿æ¥çš„æ“ä½œ

#### Edge Toolbar (è¾¹å·¥å…·æ )
**æ˜¾ç¤ºæ¡ä»¶**: é€‰ä¸­å•æ¡è¾¹æ—¶æ˜¾ç¤ºåœ¨è¾¹çš„ä¸­ç‚¹

**åŠŸèƒ½**:
- â¸ï¸ **æš‚åœ/ç»§ç»­**: æ ‡è®°å·¥ä½œæµæš‚åœç‚¹
- ğŸ—‘ï¸ **åˆ é™¤**: ç§»é™¤è¿æ¥

**æš‚åœæ ‡è®°**:
- ç‚¹å‡»æš‚åœå›¾æ ‡åï¼Œè¾¹ä¸Šæ˜¾ç¤ºæš‚åœæ ‡è®°
- å·¥ä½œæµæ‰§è¡Œåˆ°æ­¤å¤„æ—¶ä¼šæš‚åœ
- éœ€è¦æ‰‹åŠ¨ç‚¹å‡» "Run" ç»§ç»­
- å†æ¬¡ç‚¹å‡»å›¾æ ‡å–æ¶ˆæš‚åœ

**ä½ç½®**: `src/components/EdgeToolbar.tsx`

---

### è¿æ¥éªŒè¯

**ç±»å‹æ£€æŸ¥**:
- åœ¨ `isValidConnection()` ä¸­éªŒè¯
- åªå…è®¸ç›¸åŒç±»å‹çš„å¥æŸ„è¿æ¥
- ä½ç½®: `src/components/WorkflowCanvas.tsx`

**å¤šé‡æ€§è§„åˆ™**:
- **Image è¾“å…¥**: æ”¯æŒå¤šä¸ªè¿æ¥ï¼ˆå¤šå›¾è¾“å…¥ï¼‰
- **Text è¾“å…¥**: åªä¿ç•™æœ€åä¸€ä¸ªè¿æ¥ï¼ˆå•æ–‡æœ¬ï¼‰

**å·¥ä½œæµéªŒè¯**:
- æ£€æŸ¥å¿…éœ€è¾“å…¥æ˜¯å¦å·²è¿æ¥
- æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¾ªç¯ä¾èµ–
- ä½ç½®: `src/store/workflowStore.ts` - `validateWorkflow()`

---

## ç”»å¸ƒäº¤äº’

### è§†å›¾æ§åˆ¶

#### ç¼©æ”¾æ“ä½œ

**æ–¹æ³• 1: é”®ç›˜å¿«æ·é”®**
- `Cmd/Ctrl + =` æˆ– `+` - æ”¾å¤§
- `Cmd/Ctrl + -` - ç¼©å°
- `Cmd/Ctrl + 0` - é€‚åº”è§†å›¾ï¼ˆFit Viewï¼‰
- `Cmd/Ctrl + 1` - é‡ç½®ä¸º 100%

**æ–¹æ³• 2: é¼ æ ‡æ»šè½®**
- **macOS**: `Cmd + æ»šè½®` ç¼©æ”¾
- **Windows/Linux**: `Ctrl + æ»šè½®` ç¼©æ”¾
- æ— ä¿®é¥°é”®æ—¶ï¼Œé¼ æ ‡æ»šè½®é»˜è®¤ç¼©æ”¾ï¼ˆé macOS è§¦æ§æ¿ï¼‰

**æ–¹æ³• 3: è§¦æ§æ¿æ‰‹åŠ¿**
- åŒæŒ‡æåˆ/å±•å¼€ç¼©æ”¾ï¼ˆPinch Gestureï¼‰

**æŠ€æœ¯ç»†èŠ‚**:
- ç¼©æ”¾æ—¶èŠ‚ç‚¹è¾¹æ¡†å®½åº¦ä¿æŒå›ºå®šï¼ˆä½¿ç”¨ CSS å˜é‡åŠ¨æ€è®¡ç®—ï¼‰
- è¾¹æ¡†å§‹ç»ˆæ¸…æ™°å¯è§ï¼Œä¸éšç¼©æ”¾å˜åŒ–
- å®ç°: `src/components/WorkflowCanvas.tsx` - `handleWheel()`

---

#### å¹³ç§»æ“ä½œ

**æ–¹æ³• 1: ç©ºæ ¼é”®æ‹–æ‹½**ï¼ˆ**æ¨èï¼Œç±»ä¼¼ Figma**ï¼‰
1. **æŒ‰ä½ç©ºæ ¼é”®**
2. é¼ æ ‡åœ¨ä»»æ„ä½ç½®æ‹–æ‹½
3. ç”»å¸ƒè·Ÿéšç§»åŠ¨
4. **é‡è¦**: ç©ºæ ¼é”®æŒ‰ä½æ—¶ï¼ŒèŠ‚ç‚¹æ‹–æ‹½è¢«ç¦ç”¨ï¼Œåªèƒ½ç§»åŠ¨ç”»å¸ƒ

**æ–¹æ³• 2: é¼ æ ‡ä¸­é”®**
- æŒ‰ä½é¼ æ ‡ä¸­é”®æ‹–æ‹½

**æ–¹æ³• 3: è§¦æ§æ¿**
- åŒæŒ‡æ»‘åŠ¨ï¼ˆmacOS trackpadï¼‰

**ç©ºæ ¼é”®äº¤äº’ç»†èŠ‚**:
- æŒ‰ä½ç©ºæ ¼æ—¶å…‰æ ‡å˜ä¸º `grab`
- æ‹–åŠ¨æ—¶å…‰æ ‡å˜ä¸º `grabbing`
- é¡¶éƒ¨æ˜¾ç¤ºæç¤º: "æŒ‰ä½ç©ºæ ¼é”®æ‹–åŠ¨ç”»å¸ƒ"
- èŠ‚ç‚¹æ‚¬åœæ•ˆæœè¢«ç¦ç”¨
- é‡Šæ”¾ç©ºæ ¼é”®æ¢å¤æ­£å¸¸äº¤äº’

**å®ç°**:
- ç©ºæ ¼é”®çŠ¶æ€å­˜å‚¨: `workflowStore.ts` - `spaceBarPressed`
- èŠ‚ç‚¹æ‹–æ‹½ç¦ç”¨: `WorkflowCanvas.tsx` - `nodesDraggable={!spaceBarPressed}`
- å…‰æ ‡æ§åˆ¶: `BaseNode.tsx` - `cursor: spaceBarPressed ? 'grab' : ...`

---

### èŠ‚ç‚¹æ“ä½œ

#### é€‰æ‹©èŠ‚ç‚¹

**å•é€‰**:
- ç‚¹å‡»èŠ‚ç‚¹é€‰ä¸­
- é€‰ä¸­èŠ‚ç‚¹æ˜¾ç¤ºé»„è‰²è¾¹æ¡†

**å¤šé€‰**:
- `Shift + ç‚¹å‡»` - å¤šé€‰
- æ¡†é€‰ - æ‹–æ‹½ç©ºç™½åŒºåŸŸ
- æ”¯æŒéƒ¨åˆ†é€‰æ‹©æ¨¡å¼ï¼ˆSelectionMode.Partialï¼‰

**å–æ¶ˆé€‰æ‹©**:
- ç‚¹å‡»ç©ºç™½åŒºåŸŸ

---

#### ç§»åŠ¨èŠ‚ç‚¹

**æ‹–æ‹½ç§»åŠ¨**:
- é¼ æ ‡æ‚¬åœåœ¨èŠ‚ç‚¹ä¸Šæ—¶å…‰æ ‡å˜ä¸º `pointer`
- æŒ‰ä½å·¦é”®æ‹–æ‹½ç§»åŠ¨å•ä¸ªèŠ‚ç‚¹
- å¤šé€‰åæ‹–æ‹½åŒæ—¶ç§»åŠ¨æ‰€æœ‰é€‰ä¸­èŠ‚ç‚¹

**çº¦æŸ**:
- æŒ‰ä½ç©ºæ ¼é”®æ—¶**æ— æ³•æ‹–æ‹½èŠ‚ç‚¹**ï¼ˆåªèƒ½ç§»åŠ¨ç”»å¸ƒï¼‰
- æ‹–æ‹½é˜ˆå€¼: 5pxï¼ˆé¿å…è¯¯è§¦ï¼‰

**åˆ†ç»„ç§»åŠ¨**:
- å±äºåŒä¸€åˆ†ç»„çš„èŠ‚ç‚¹å¯é€šè¿‡åˆ†ç»„å¤´éƒ¨æ‹–æ‹½
- ä¿æŒèŠ‚ç‚¹ç›¸å¯¹ä½ç½®

---

#### è°ƒæ•´èŠ‚ç‚¹å¤§å°

**æ“ä½œ**:
- æ‹–æ‹½èŠ‚ç‚¹è¾¹ç¼˜å’Œè§’è½çš„è°ƒæ•´æŸ„
- æ”¯æŒæ°´å¹³ã€å‚ç›´ã€å¯¹è§’çº¿è°ƒæ•´

**å¤šé€‰è°ƒæ•´**:
- é€‰ä¸­å¤šä¸ªèŠ‚ç‚¹
- è°ƒæ•´ä»»ä¸€èŠ‚ç‚¹å¤§å°
- å…¶ä»–é€‰ä¸­èŠ‚ç‚¹åŒæ­¥è°ƒæ•´åˆ°ç›¸åŒå°ºå¯¸

**æœ€å°å°ºå¯¸é™åˆ¶**:
- ä¸åŒèŠ‚ç‚¹ç±»å‹æœ‰ä¸åŒçš„æœ€å°å°ºå¯¸
- é˜²æ­¢å†…å®¹æº¢å‡º

**å®ç°**: `BaseNode.tsx` - `NodeResizer`

---

#### åˆ é™¤èŠ‚ç‚¹

**æ–¹æ³•**:
- é€‰ä¸­èŠ‚ç‚¹åæŒ‰ `Backspace` æˆ– `Delete`
- è‡ªåŠ¨åˆ é™¤ç›¸å…³çš„è¿æ¥
- ä»åˆ†ç»„ä¸­ç§»é™¤ï¼ˆå¦‚æœæœ‰ï¼‰

**æ•°æ®æ¸…ç†**:
- è‡ªåŠ¨åˆ é™¤ IndexedDB ä¸­çš„å›¾ç‰‡ç¼“å­˜
- æ¸…ç† localStorage ä¸­çš„èŠ‚ç‚¹æ•°æ®

---

#### èŠ‚ç‚¹æ‚¬åœæ•ˆæœ

**æ­£å¸¸æ¨¡å¼**:
- é¼ æ ‡æ‚¬åœæ˜¾ç¤ºç°è‰²è¾¹æ¡†ï¼ˆ1pxï¼‰
- å…‰æ ‡å˜ä¸º `pointer`
- æç¤ºå¯ä»¥ç‚¹å‡»æ“ä½œ

**ç©ºæ ¼é”®æ¨¡å¼**:
- æŒ‰ä½ç©ºæ ¼é”®æ—¶**ä¸æ˜¾ç¤º**æ‚¬åœæ•ˆæœ
- é¿å…å¹²æ‰°ç”»å¸ƒæ‹–åŠ¨

**å®ç°**: `BaseNode.tsx` - `handleMouseEnter/Leave`

---

### èŠ‚ç‚¹æ’åˆ—

é€‰ä¸­å¤šä¸ªèŠ‚ç‚¹åï¼Œä½¿ç”¨å¿«æ·é”®å¿«é€Ÿæ’åˆ—ï¼š

#### å‚ç›´å †å  (`V` é”®)
- æŒ‰ç°æœ‰ Y åæ ‡æ’åº
- å‚ç›´æ–¹å‘å †å 
- é—´éš” 20px
- å·¦å¯¹é½ï¼ˆä½¿ç”¨æœ€å·¦ä¾§èŠ‚ç‚¹çš„ X åæ ‡ï¼‰

#### æ°´å¹³å †å  (`H` é”®)
- æŒ‰ç°æœ‰ X åæ ‡æ’åº
- æ°´å¹³æ–¹å‘æ’åˆ—
- é—´éš” 20px
- é¡¶å¯¹é½ï¼ˆä½¿ç”¨æœ€ä¸Šæ–¹èŠ‚ç‚¹çš„ Y åæ ‡ï¼‰

#### ç½‘æ ¼æ’åˆ— (`G` é”®)
- è‡ªåŠ¨è®¡ç®—è¡Œåˆ—æ•°ï¼ˆæ¥è¿‘æ­£æ–¹å½¢ï¼‰
- æŒ‰ä»ä¸Šåˆ°ä¸‹ã€ä»å·¦åˆ°å³æ’åˆ—
- é—´éš” 20px
- ä¿æŒèŠ‚ç‚¹ç›¸å¯¹é¡ºåº

**å®ç°**: `src/components/WorkflowCanvas.tsx` - é”®ç›˜äº‹ä»¶å¤„ç†

---

## å·¥ä½œæµæ‰§è¡Œ

### æ‰§è¡Œæ¨¡å¼

#### å®Œæ•´æ‰§è¡Œ

**è§¦å‘æ–¹å¼**:
- ç‚¹å‡» Header çš„ "Run" æŒ‰é’®

**æ‰§è¡Œæµç¨‹**:
1. **æ‹“æ‰‘æ’åº**: æ ¹æ®è¿æ¥å…³ç³»ç¡®å®šèŠ‚ç‚¹æ‰§è¡Œé¡ºåº
2. **ä¾èµ–ä¼˜å…ˆ**: å…ˆæ‰§è¡Œè¢«ä¾èµ–çš„èŠ‚ç‚¹
3. **é¡ºåºæ‰§è¡Œ**: æŒ‰æ’åºç»“æœä¾æ¬¡æ‰§è¡Œæ¯ä¸ªèŠ‚ç‚¹
4. **æš‚åœæ£€æŸ¥**: é‡åˆ°æ ‡è®°æš‚åœçš„è¾¹æ—¶åœæ­¢
5. **é”™è¯¯å¤„ç†**: é‡åˆ°é”™è¯¯æ—¶åœæ­¢æ•´ä¸ªå·¥ä½œæµ

**çŠ¶æ€æŒ‡ç¤º**:
- å½“å‰æ‰§è¡ŒèŠ‚ç‚¹æ˜¾ç¤ºè“è‰²è¾¹æ¡†
- èŠ‚ç‚¹å†…éƒ¨æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- Header æ˜¾ç¤º "Stop" æŒ‰é’®

---

#### ä»èŠ‚ç‚¹æ‰§è¡Œ

**è§¦å‘æ–¹å¼**:
- é€‰ä¸­èŠ‚ç‚¹åæŒ‰ `Enter` é”®
- ç‚¹å‡»èŠ‚ç‚¹çš„ "Generate" æŒ‰é’®ï¼ˆå¦‚æœæœ‰ï¼‰

**è¡Œä¸º**:
- ä»è¯¥èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œå·¥ä½œæµ
- è·³è¿‡è¯¥èŠ‚ç‚¹ä¹‹å‰çš„æ‰€æœ‰èŠ‚ç‚¹
- é€‚ç”¨äºéƒ¨åˆ†é‡æ–°ç”Ÿæˆ

---

#### æš‚åœä¸ç»§ç»­

**è®¾ç½®æš‚åœç‚¹**:
1. é€‰ä¸­ä¸€æ¡è¾¹
2. ç‚¹å‡» Edge Toolbar çš„æš‚åœå›¾æ ‡
3. è¾¹ä¸Šæ˜¾ç¤ºæš‚åœæ ‡è®°

**æš‚åœè¡Œä¸º**:
- å·¥ä½œæµæ‰§è¡Œåˆ°æš‚åœè¾¹æ—¶è‡ªåŠ¨åœæ­¢
- æ˜¾ç¤º Toast æç¤º: "Workflow paused - click Run to continue"
- ä¿å­˜æš‚åœä½ç½® (`pausedAtNodeId`)

**ç»§ç»­æ‰§è¡Œ**:
- ç‚¹å‡» Header çš„ "Run" æŒ‰é’®
- ä»æš‚åœçš„èŠ‚ç‚¹ç»§ç»­æ‰§è¡Œ
- ä¸ä¼šé‡å¤æ‰§è¡Œæš‚åœæ£€æŸ¥

---

#### åœæ­¢æ‰§è¡Œ

**è§¦å‘æ–¹å¼**:
- ç‚¹å‡» Header çš„ "Stop" æŒ‰é’®

**è¡Œä¸º**:
- ç«‹å³åœæ­¢å½“å‰èŠ‚ç‚¹çš„æ‰§è¡Œ
- è®¾ç½® `isRunning = false`
- æ¸…é™¤å½“å‰æ‰§è¡ŒçŠ¶æ€

---

### èŠ‚ç‚¹æ‰§è¡Œé€»è¾‘

#### Image Input
- æ— éœ€æ‰§è¡Œ
- å›¾ç‰‡æ•°æ®å·²åœ¨åŠ è½½æ—¶å‡†å¤‡å¥½

#### Annotation
- è·å–è¿æ¥çš„å›¾ç‰‡
- è®¾ç½®ä¸º `sourceImage`
- å¦‚æœæ— æ ‡æ³¨ï¼Œç›´æ¥ä¼ é€’å›¾ç‰‡åˆ°è¾“å‡º

#### Prompt
- æ— éœ€æ‰§è¡Œ
- æ–‡æœ¬æ•°æ®å·²åœ¨è¾“å…¥æ—¶å‡†å¤‡å¥½

#### Nano Banana
1. è·å–è¿æ¥çš„è¾“å…¥ï¼ˆ`getConnectedInputs()`ï¼‰
   - `text`: å¿…éœ€
   - `images`: å¯é€‰
2. éªŒè¯å¿…éœ€è¾“å…¥
3. è®¾ç½®çŠ¶æ€ä¸º `loading`
4. è°ƒç”¨ `/api/generate` API
5. ç­‰å¾…ç”Ÿæˆç»“æœ
6. ä¿å­˜åˆ° `outputImage`
7. æ·»åŠ åˆ°å…¨å±€å†å²è®°å½•
8. ï¼ˆå¯é€‰ï¼‰è‡ªåŠ¨ä¿å­˜åˆ° generations æ–‡ä»¶å¤¹
9. è®¾ç½®çŠ¶æ€ä¸º `complete` æˆ– `error`

#### LLM Generate
1. è·å–è¿æ¥çš„æ–‡æœ¬è¾“å…¥
2. éªŒè¯å¿…éœ€è¾“å…¥
3. è®¾ç½®çŠ¶æ€ä¸º `loading`
4. è°ƒç”¨ `/api/llm` API
5. ç­‰å¾…ç”Ÿæˆç»“æœ
6. ä¿å­˜åˆ° `outputText`
7. è®¾ç½®çŠ¶æ€ä¸º `complete` æˆ– `error`

#### Split Grid
1. è·å–è¿æ¥çš„å›¾ç‰‡
2. éªŒè¯èŠ‚ç‚¹å·²é…ç½®
3. ä½¿ç”¨ `gridSplitter.ts` åˆ†å‰²å›¾ç‰‡
4. åˆ›å»ºå­èŠ‚ç‚¹ï¼ˆImageInput, Prompt, NanoBananaï¼‰
5. å»ºç«‹è¿æ¥å…³ç³»
6. æŒ‰ç½‘æ ¼å¸ƒå±€æ’åˆ—
7. è®¾ç½®çŠ¶æ€ä¸º `complete`

#### Output
- è·å–è¿æ¥çš„å›¾ç‰‡
- è®¾ç½®ä¸º `image` ç”¨äºæ˜¾ç¤º

**å®ç°**: `src/store/workflowStore.ts` - `executeWorkflow()`

---

### çŠ¶æ€ç®¡ç†

**èŠ‚ç‚¹çŠ¶æ€**:
```typescript
type NodeStatus = 'idle' | 'loading' | 'complete' | 'error';
```

**è§†è§‰åé¦ˆ**:
- `idle`: é»˜è®¤çŠ¶æ€ï¼Œæ— ç‰¹æ®Šæ ‡è®°
- `loading`: è“è‰²è¾¹æ¡† + åŠ è½½åŠ¨ç”»
- `complete`: ç»¿è‰²å‹¾é€‰å›¾æ ‡
- `error`: çº¢è‰²è¾¹æ¡† + é”™è¯¯æ¶ˆæ¯

**å…¨å±€çŠ¶æ€**:
- `isRunning`: å·¥ä½œæµæ˜¯å¦æ­£åœ¨è¿è¡Œ
- `currentNodeId`: å½“å‰æ‰§è¡Œçš„èŠ‚ç‚¹ ID
- `pausedAtNodeId`: æš‚åœä½ç½®çš„èŠ‚ç‚¹ ID

---

### é”™è¯¯å¤„ç†

**éªŒè¯é”™è¯¯**:
- ç¼ºå°‘å¿…éœ€è¾“å…¥ â†’ æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œåœæ­¢æ‰§è¡Œ
- èŠ‚ç‚¹æœªé…ç½® â†’ æç¤ºé…ç½®ï¼Œåœæ­¢æ‰§è¡Œ

**API é”™è¯¯**:
- HTTP é”™è¯¯ â†’ æ˜¾ç¤ºçŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯
- ç½‘ç»œé”™è¯¯ â†’ æ˜¾ç¤ºå‹å¥½æç¤º
- è¶…æ—¶ â†’ æç¤ºå‡å°å›¾ç‰‡æˆ–ç®€åŒ–æç¤ºè¯

**é”™è¯¯å±•ç¤º**:
- èŠ‚ç‚¹è¾¹æ¡†å˜ä¸ºçº¢è‰²
- èŠ‚ç‚¹å†…æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
- å·¥ä½œæµåœæ­¢æ‰§è¡Œ

---

## æ–‡ä»¶ç®¡ç†

### ä¿å­˜å·¥ä½œæµ

#### æ‰‹åŠ¨ä¸‹è½½

**æ“ä½œ**:
1. ç‚¹å‡» Header çš„ "Save" æŒ‰é’®
2. è‡ªåŠ¨ä¸‹è½½ JSON æ–‡ä»¶

**æ–‡ä»¶æ ¼å¼**:
```json
{
  "version": 1,
  "id": "wf_xxx",
  "name": "workflow-2025-12-26",
  "nodes": [...],
  "edges": [...],
  "edgeStyle": "curved",
  "groups": {...}
}
```

**æ³¨æ„**:
- èŠ‚ç‚¹ä¸­çš„å›¾ç‰‡æ•°æ®**ä¸ä¿å­˜**åœ¨ JSON ä¸­
- å›¾ç‰‡å­˜å‚¨åœ¨æµè§ˆå™¨ IndexedDB ä¸­

---

#### è‡ªåŠ¨ä¿å­˜

**è§¦å‘æ¡ä»¶**:
- é…ç½®äº†ä¿å­˜è·¯å¾„ï¼ˆé€šè¿‡ `/api/workflow`ï¼‰
- æœ‰æœªä¿å­˜çš„å˜æ›´
- æ¯ 90 ç§’æ£€æŸ¥ä¸€æ¬¡

**é…ç½®æ–¹å¼**:
1. é¦–æ¬¡ä¿å­˜æ—¶é€‰æ‹©ä¿å­˜ç›®å½•
2. å·¥ä½œæµ ID å’Œè·¯å¾„å­˜å‚¨åœ¨ localStorage
3. åç»­è‡ªåŠ¨ä¿å­˜åˆ°ç›¸åŒä½ç½®

**çŠ¶æ€æ˜¾ç¤º**:
- Header æ˜¾ç¤º "Last saved: X ç§’å‰"
- ä¿å­˜æ—¶æ˜¾ç¤º "Saving..." æç¤º

**å®ç°**: `src/store/workflowStore.ts` - `saveToFile()`

---

### åŠ è½½å·¥ä½œæµ

#### æ‹–æ‹½åŠ è½½

**æ“ä½œ**:
1. æ‹–æ‹½ `.json` å·¥ä½œæµæ–‡ä»¶åˆ°ç”»å¸ƒ
2. æ˜¾ç¤º "Drop to load workflow" æç¤º
3. æ¾å¼€é¼ æ ‡è‡ªåŠ¨åŠ è½½

---

#### ç‚¹å‡»åŠ è½½

**æ“ä½œ**:
1. ç‚¹å‡» Header çš„ "Load" æŒ‰é’®ï¼ˆå¦‚æœæœ‰ï¼‰
2. é€‰æ‹© `.json` æ–‡ä»¶
3. åŠ è½½å·¥ä½œæµ

---

#### åŠ è½½æµç¨‹

1. **è§£æ JSON**: è¯»å–å·¥ä½œæµæ•°æ®
2. **éªŒè¯æ ¼å¼**: æ£€æŸ¥ version å’Œå¿…éœ€å­—æ®µ
3. **åŠ è½½èŠ‚ç‚¹**: åˆ›å»ºèŠ‚ç‚¹ï¼ˆä¸å«å›¾ç‰‡ï¼‰
4. **åŠ è½½è¾¹**: é‡å»ºè¿æ¥å…³ç³»
5. **åŠ è½½åˆ†ç»„**: æ¢å¤åˆ†ç»„ä¿¡æ¯
6. **æ¢å¤å›¾ç‰‡**: ä» IndexedDB åŠ è½½ç¼“å­˜çš„å›¾ç‰‡æ•°æ®
7. **æ›´æ–° ID è®¡æ•°å™¨**: é˜²æ­¢ ID å†²çª
8. **æ¸…é™¤è¿è¡ŒçŠ¶æ€**: é‡ç½®æ‰§è¡ŒçŠ¶æ€

**å…¼å®¹æ€§**:
- æ”¯æŒå‘åå…¼å®¹ï¼ˆæ—§ç‰ˆå·¥ä½œæµï¼‰
- è‡ªåŠ¨å»é‡èŠ‚ç‚¹ ID
- è‡ªåŠ¨ä¿®å¤æŸåçš„è¿æ¥

**å®ç°**: `src/store/workflowStore.ts` - `loadWorkflow()`

---

### æ¸…ç©ºç”»å¸ƒ

**æ“ä½œ**:
1. ç‚¹å‡» Header çš„ "Clear" æŒ‰é’®
2. ç¡®è®¤å¯¹è¯æ¡†
3. åˆ é™¤æ‰€æœ‰æ•°æ®

**æ¸…é™¤å†…å®¹**:
- æ‰€æœ‰èŠ‚ç‚¹
- æ‰€æœ‰è¿æ¥
- æ‰€æœ‰åˆ†ç»„
- å·¥ä½œæµçŠ¶æ€
- **ä¿ç•™**: IndexedDB å›¾ç‰‡ç¼“å­˜ï¼ˆç”¨äºæ’¤é”€ï¼‰

---

## é«˜çº§åŠŸèƒ½

### å¤åˆ¶ç²˜è´´

#### èŠ‚ç‚¹å¤åˆ¶ç²˜è´´

**å¤åˆ¶**:
1. é€‰ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹
2. `Cmd/Ctrl + C`
3. èŠ‚ç‚¹æ•°æ®å’Œå†…éƒ¨è¿æ¥ä¿å­˜åˆ°å‰ªè´´æ¿

**ç²˜è´´**:
1. `Cmd/Ctrl + V`
2. åˆ›å»ºæ–°èŠ‚ç‚¹ï¼ˆåç§» 50pxï¼‰
3. é‡å»ºå†…éƒ¨è¿æ¥
4. ç”Ÿæˆæ–°çš„èŠ‚ç‚¹ ID
5. è‡ªåŠ¨é€‰ä¸­ç²˜è´´çš„èŠ‚ç‚¹

**è·¨è¿æ¥å¤åˆ¶**:
- åªå¤åˆ¶é€‰ä¸­èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥
- ä¸å¤–éƒ¨èŠ‚ç‚¹çš„è¿æ¥ä¸ä¼šå¤åˆ¶

**å®ç°**: `src/store/workflowStore.ts` - `copySelectedNodes()`, `pasteNodes()`

---

#### å›¾ç‰‡/æ–‡æœ¬ç²˜è´´

**ç²˜è´´å›¾ç‰‡**:
1. å¤åˆ¶å›¾ç‰‡åˆ°ç³»ç»Ÿå‰ªè´´æ¿
2. `Cmd/Ctrl + V`
3. åœ¨è§†å£ä¸­å¿ƒåˆ›å»º ImageInput èŠ‚ç‚¹
4. è‡ªåŠ¨åŠ è½½å›¾ç‰‡

**ç²˜è´´æ–‡æœ¬**:
1. å¤åˆ¶æ–‡æœ¬åˆ°ç³»ç»Ÿå‰ªè´´æ¿
2. `Cmd/Ctrl + V`
3. åœ¨è§†å£ä¸­å¿ƒåˆ›å»º Prompt èŠ‚ç‚¹
4. è‡ªåŠ¨å¡«å……æ–‡æœ¬

**ä¼˜å…ˆçº§**:
1. å†…éƒ¨å‰ªè´´æ¿ï¼ˆå¤åˆ¶çš„èŠ‚ç‚¹ï¼‰
2. ç³»ç»Ÿå‰ªè´´æ¿å›¾ç‰‡
3. ç³»ç»Ÿå‰ªè´´æ¿æ–‡æœ¬

---

### åˆ†ç»„åŠŸèƒ½

#### åˆ›å»ºåˆ†ç»„

**æ“ä½œ**:
1. é€‰ä¸­å¤šä¸ªèŠ‚ç‚¹
2. ç‚¹å‡» Multi-Select Toolbar çš„ "Group" æŒ‰é’®
3. è‡ªåŠ¨åˆ›å»ºåˆ†ç»„

**åˆ†ç»„ç‰¹æ€§**:
- å¸¦é¢œè‰²çš„èƒŒæ™¯æ¡†
- å¯ç¼–è¾‘çš„åˆ†ç»„åç§°
- è‡ªåŠ¨è®¡ç®—è¾¹ç•Œï¼ˆåŒ…å«æ‰€æœ‰èŠ‚ç‚¹ + 20px è¾¹è·ï¼‰
- 6 ç§é¢œè‰²å¾ªç¯åˆ†é…

**é¢œè‰²é€‰é¡¹**:
- ğŸ”˜ Neutral (ç°è‰²)
- ğŸ”µ Blue (è“è‰²)
- ğŸŸ¢ Green (ç»¿è‰²)
- ğŸŸ£ Purple (ç´«è‰²)
- ğŸŸ  Orange (æ©™è‰²)
- ğŸ”´ Red (çº¢è‰²)

---

#### åˆ†ç»„æ“ä½œ

**ç§»åŠ¨åˆ†ç»„**:
- æ‹–æ‹½åˆ†ç»„å¤´éƒ¨ï¼ˆæ ‡é¢˜åŒºåŸŸï¼‰
- åˆ†ç»„å†…æ‰€æœ‰èŠ‚ç‚¹åŒæ­¥ç§»åŠ¨
- ä¿æŒèŠ‚ç‚¹ç›¸å¯¹ä½ç½®

**è°ƒæ•´å¤§å°**:
- æ‹–æ‹½åˆ†ç»„è¾¹ç¼˜
- èŠ‚ç‚¹ä¸å—å½±å“ï¼ˆåªè°ƒæ•´èƒŒæ™¯æ¡†ï¼‰

**é‡å‘½å**:
1. åŒå‡»åˆ†ç»„åç§°
2. è¾“å…¥æ–°åç§°
3. `Enter` ç¡®è®¤æˆ– `Esc` å–æ¶ˆ

**æ”¹å˜é¢œè‰²**:
1. ç‚¹å‡»åˆ†ç»„å·¥å…·æ çš„è°ƒè‰²æ¿å›¾æ ‡
2. é€‰æ‹©æ–°é¢œè‰²
3. èƒŒæ™¯é¢œè‰²ç«‹å³æ›´æ–°

**è§£æ•£åˆ†ç»„**:
1. ç‚¹å‡»åˆ†ç»„å·¥å…·æ çš„åˆ é™¤æŒ‰é’®
2. åˆ é™¤åˆ†ç»„ï¼ˆèŠ‚ç‚¹ä¿ç•™ï¼‰

---

#### èŠ‚ç‚¹ä¸åˆ†ç»„

**æ·»åŠ èŠ‚ç‚¹åˆ°åˆ†ç»„**:
- æ‹–æ‹½èŠ‚ç‚¹åˆ°åˆ†ç»„åŒºåŸŸ
- èŠ‚ç‚¹ä¸­å¿ƒåœ¨åˆ†ç»„å†…æ—¶è‡ªåŠ¨åŠ å…¥
- èŠ‚ç‚¹åœæ­¢æ‹–æ‹½æ—¶æ£€æµ‹

**ä»åˆ†ç»„ç§»é™¤èŠ‚ç‚¹**:
- æ‹–æ‹½èŠ‚ç‚¹åˆ°åˆ†ç»„å¤–
- è‡ªåŠ¨ä»åˆ†ç»„ç§»é™¤

**åˆ†ç»„æˆå‘˜ç®¡ç†**:
- èŠ‚ç‚¹è®°å½• `groupId` å±æ€§
- åˆ†ç»„å­˜å‚¨åœ¨ `workflowStore.groups`

**å®ç°**: `src/components/GroupsOverlay.tsx`

---

### æ’¤é”€/é‡åš

#### å†å²æ ˆ

**å·¥ä½œåŸç†**:
- æ¯æ¬¡æ“ä½œåä¿å­˜çŠ¶æ€å¿«ç…§
- æœ€å¤šä¿å­˜ 50 ä¸ªå†å²çŠ¶æ€
- æ”¯æŒå‰è¿›/åé€€

**ä¿å­˜æ—¶æœº**:
- æ·»åŠ /åˆ é™¤èŠ‚ç‚¹
- æ·»åŠ /åˆ é™¤è¿æ¥
- ç§»åŠ¨èŠ‚ç‚¹
- åˆ›å»º/åˆ é™¤åˆ†ç»„
- é‡è¦æ•°æ®å˜æ›´

**ä¸ä¿å­˜æ—¶æœº**:
- é€‰æ‹©èŠ‚ç‚¹
- æ‚¬åœèŠ‚ç‚¹
- è§†å›¾ç¼©æ”¾/å¹³ç§»

---

#### æ“ä½œ

**æ’¤é”€**:
- `Cmd/Ctrl + Z`
- å›é€€åˆ°ä¸Šä¸€ä¸ªçŠ¶æ€
- æ¢å¤èŠ‚ç‚¹ã€è¾¹ã€åˆ†ç»„

**é‡åš**:
- `Cmd/Ctrl + Shift + Z`
- å‰è¿›åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€
- æ¢å¤è¢«æ’¤é”€çš„æ“ä½œ

**é™åˆ¶**:
- ä¸èƒ½æ’¤é”€æ–‡ä»¶æ“ä½œï¼ˆä¿å­˜/åŠ è½½ï¼‰
- ä¸èƒ½æ’¤é”€ API è°ƒç”¨ï¼ˆå›¾ç‰‡ç”Ÿæˆï¼‰
- ä¸èƒ½æ¢å¤å·²åˆ é™¤çš„å›¾ç‰‡ç¼“å­˜

**å®ç°**: `src/store/workflowStore.ts` - `undo()`, `redo()`, `historyStack`

---

### å…¨å±€å›¾ç‰‡å†å²

#### å†å²è®°å½•

**è‡ªåŠ¨ä¿å­˜**:
- æ‰€æœ‰ Nano Banana ç”Ÿæˆçš„å›¾ç‰‡
- Split Grid åˆ†å‰²çš„å›¾ç‰‡
- è®°å½•æ—¶é—´æˆ³ã€æç¤ºè¯ã€ç”Ÿæˆå‚æ•°

**æ•°æ®ç»“æ„**:
```typescript
{
  id: string;
  image: string; // Base64
  timestamp: number;
  prompt: string;
  aspectRatio: string;
  model: string;
}
```

---

#### å†å²é¢æ¿

**æ‰“å¼€æ–¹å¼**:
- ç‚¹å‡» Header çš„å†å²å›¾æ ‡ï¼ˆå¦‚æœæœ‰ï¼‰
- æˆ–è€…é€šè¿‡å³ä¾§æµ®åŠ¨æŒ‰é’®

**åŠŸèƒ½**:
- æ˜¾ç¤ºç¼©ç•¥å›¾åˆ—è¡¨
- æ˜¾ç¤ºç”Ÿæˆæç¤ºè¯
- æ˜¾ç¤ºç”Ÿæˆæ—¶é—´
- ä»æ–°åˆ°æ—§æ’åº

**ä½¿ç”¨å†å²å›¾ç‰‡**:
1. æ‹–æ‹½å†å²å›¾ç‰‡åˆ°ç”»å¸ƒ
2. è‡ªåŠ¨åˆ›å»º ImageInput èŠ‚ç‚¹
3. è‡ªåŠ¨åŠ è½½å›¾ç‰‡æ•°æ®

**æ¸…ç©ºå†å²**:
- ç‚¹å‡» "Clear All" æŒ‰é’®
- ç¡®è®¤ååˆ é™¤æ‰€æœ‰è®°å½•

**å®ç°**: `src/components/GlobalImageHistory.tsx`

---

### å¤šé€‰å·¥å…·æ 

**æ˜¾ç¤ºæ¡ä»¶**:
- é€‰ä¸­ 2 ä¸ªæˆ–æ›´å¤šèŠ‚ç‚¹æ—¶æ˜¾ç¤º

**åŠŸèƒ½**:
- ğŸ“Š æ˜¾ç¤ºé€‰ä¸­èŠ‚ç‚¹æ•°é‡
- ğŸ“¦ åˆ›å»ºåˆ†ç»„
- ğŸ”„ æ‰¹é‡å†ç”Ÿæˆï¼ˆNano Banana èŠ‚ç‚¹ï¼‰

**ä½ç½®**: ç”»å¸ƒé¡¶éƒ¨ä¸­å¤®

**å®ç°**: `src/components/MultiSelectToolbar.tsx`

---

## é”®ç›˜å¿«æ·é”®

### èŠ‚ç‚¹åˆ›å»º

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `Shift + I` | åˆ›å»º Image Input èŠ‚ç‚¹ |
| `Shift + P` | åˆ›å»º Prompt èŠ‚ç‚¹ |
| `Shift + G` | åˆ›å»º Nano Banana èŠ‚ç‚¹ |
| `Shift + L` | åˆ›å»º LLM Generate èŠ‚ç‚¹ |
| `Shift + A` | åˆ›å»º Annotation èŠ‚ç‚¹ |

*èŠ‚ç‚¹åœ¨è§†å£ä¸­å¿ƒåˆ›å»º*

---

### è§†å›¾æ§åˆ¶

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `Cmd/Ctrl + 0` | é€‚åº”è§†å›¾ (Fit View) |
| `Cmd/Ctrl + 1` | é‡ç½®ä¸º 100% ç¼©æ”¾ |
| `Cmd/Ctrl + =` / `+` | æ”¾å¤§ |
| `Cmd/Ctrl + -` | ç¼©å° |
| `Cmd/Ctrl + æ»šè½®` | ç¼©æ”¾ï¼ˆmacOS/Windows/Linuxï¼‰ |
| `ç©ºæ ¼ + æ‹–æ‹½` | å¹³ç§»ç”»å¸ƒ |
| `ä¸­é”®æ‹–æ‹½` | å¹³ç§»ç”»å¸ƒ |

---

### ç¼–è¾‘æ“ä½œ

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `Cmd/Ctrl + C` | å¤åˆ¶é€‰ä¸­èŠ‚ç‚¹ |
| `Cmd/Ctrl + V` | ç²˜è´´èŠ‚ç‚¹/å›¾ç‰‡/æ–‡æœ¬ |
| `Cmd/Ctrl + Z` | æ’¤é”€ |
| `Cmd/Ctrl + Shift + Z` | é‡åš |
| `Backspace` / `Delete` | åˆ é™¤é€‰ä¸­èŠ‚ç‚¹/è¾¹ |
| `Enter` | æ‰§è¡Œé€‰ä¸­èŠ‚ç‚¹çš„å·¥ä½œæµ |
| `Shift + ç‚¹å‡»` | å¤šé€‰èŠ‚ç‚¹ |

---

### èŠ‚ç‚¹æ’åˆ—ï¼ˆå¤šé€‰æ—¶ï¼‰

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `V` | å‚ç›´å †å  |
| `H` | æ°´å¹³å †å  |
| `G` | ç½‘æ ¼æ’åˆ— |

---

## æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

**å‰ç«¯æ¡†æ¶**:
- âš›ï¸ **React 19** - UI æ¡†æ¶
- âš¡ **Next.js 16** - React å…¨æ ˆæ¡†æ¶
- ğŸ¨ **Tailwind CSS 4** - æ ·å¼æ¡†æ¶

**å·¥ä½œæµå¼•æ“**:
- ğŸ”· **React Flow (XYFlow)** - èŠ‚ç‚¹å·¥ä½œæµåº“
- ğŸ—‚ï¸ **Zustand** - çŠ¶æ€ç®¡ç†

**å›¾ç‰‡å¤„ç†**:
- ğŸ–¼ï¸ **Konva.js** - Canvas ç»˜å›¾åº“ï¼ˆæ ‡æ³¨åŠŸèƒ½ï¼‰
- ğŸ¨ **Canvas API** - å›¾ç‰‡åˆ†å‰²å’Œå¤„ç†

**æ•°æ®å­˜å‚¨**:
- ğŸ’¾ **IndexedDB** - å›¾ç‰‡ç¼“å­˜
- ğŸ’¾ **LocalStorage** - å·¥ä½œæµæ•°æ®ï¼ˆä¸å«å›¾ç‰‡ï¼‰

**API è°ƒç”¨**:
- ğŸ¤– **Google Gemini API** - å›¾ç‰‡ç”Ÿæˆ
- ğŸ§  **OpenAI/Anthropic API** - æ–‡æœ¬ç”Ÿæˆ

---

### æ ¸å¿ƒæ¨¡å—

#### çŠ¶æ€ç®¡ç†
**æ–‡ä»¶**: `src/store/workflowStore.ts`

**èŒè´£**:
- èŠ‚ç‚¹å’Œè¾¹çš„å¢åˆ æ”¹æŸ¥
- å·¥ä½œæµæ‰§è¡Œé€»è¾‘
- å†å²æ ˆç®¡ç†ï¼ˆæ’¤é”€/é‡åšï¼‰
- åˆ†ç»„ç®¡ç†
- æ•°æ®æŒä¹…åŒ–

**ä¸»è¦ API**:
```typescript
// èŠ‚ç‚¹æ“ä½œ
addNode(type, position) -> nodeId
updateNodeData(nodeId, data)
removeNode(nodeId)

// è¾¹æ“ä½œ
onConnect(connection)
removeEdge(edgeId)
toggleEdgePause(edgeId)

// å·¥ä½œæµæ‰§è¡Œ
executeWorkflow(startNodeId?)
stopWorkflow()
regenerateNode(nodeId)

// å†å²æ“ä½œ
undo()
redo()
saveToHistory()

// åˆ†ç»„æ“ä½œ
createGroup(nodeIds)
deleteGroup(groupId)
updateGroup(groupId, updates)
```

---

#### å›¾ç‰‡ç¼“å­˜
**æ–‡ä»¶**: `src/utils/imageCache.ts`

**èŒè´£**:
- å›¾ç‰‡æ•°æ®å­˜å‚¨åˆ° IndexedDB
- å›¾ç‰‡æ•°æ®åŠ è½½å’Œæ¢å¤
- ç¼“å­˜æ¸…ç†

**ä¸»è¦ API**:
```typescript
saveNodeImageData(nodeId, payload)
loadNodeImageData(nodeId) -> payload
loadAllNodeImageData(nodeIds) -> Record<id, payload>
deleteNodeImageData(nodeId)
clearAllNodeImageData()
```

**ä¼˜åŒ–**:
- æ–°èŠ‚ç‚¹åˆ›å»ºæ—¶æ¸…é™¤æ—§ç¼“å­˜ï¼ˆé˜²æ­¢ ID å†²çªï¼‰
- èŠ‚ç‚¹åˆ é™¤æ—¶è‡ªåŠ¨æ¸…ç†ç¼“å­˜
- å·¥ä½œæµåŠ è½½æ—¶æ‰¹é‡æ¢å¤

---

#### ç½‘æ ¼åˆ†å‰²
**æ–‡ä»¶**: `src/utils/gridSplitter.ts`

**èŒè´£**:
- æ£€æµ‹å›¾ç‰‡ä¸­çš„ç½‘æ ¼å¸ƒå±€
- è‡ªåŠ¨è®¡ç®—è¡Œåˆ—æ•°
- åˆ†å‰²å›¾ç‰‡ä¸ºå•ç‹¬çš„å­å›¾

**ä¸»è¦ API**:
```typescript
detectAndSplitGrid(image) -> { grid, images }
splitWithDimensions(image, rows, cols) -> { images }
```

**ç®—æ³•**:
1. åˆ†æå›¾ç‰‡è¾¹ç¼˜æ£€æµ‹
2. è¯†åˆ«ç½‘æ ¼çº¿
3. è®¡ç®—ç½‘æ ¼å•å…ƒä½ç½®
4. ä½¿ç”¨ Canvas è£å‰ªå›¾ç‰‡

---

#### å·¥ä½œæµç”»å¸ƒ
**æ–‡ä»¶**: `src/components/WorkflowCanvas.tsx`

**èŒè´£**:
- React Flow é›†æˆ
- è¿æ¥éªŒè¯å’Œåˆ›å»º
- æ‹–æ‹½å¤„ç†
- é”®ç›˜å¿«æ·é”®
- è§†å›¾æ§åˆ¶

**å…³é”®åŠŸèƒ½**:
- ç©ºæ ¼é”®ç”»å¸ƒæ‹–åŠ¨
- Cmd/Ctrl + æ»šè½®ç¼©æ”¾
- æ‹–æ‹½æ–‡ä»¶/å›¾ç‰‡è‡ªåŠ¨åˆ›å»ºèŠ‚ç‚¹
- è¿æ¥æ‹–æ‹½åˆ°ç©ºç™½å¤„åˆ›å»ºèŠ‚ç‚¹
- èŠ‚ç‚¹æ’åˆ—ï¼ˆV/H/Gï¼‰

---

### æ•°æ®æµ

#### èŠ‚ç‚¹æ‰§è¡Œæ•°æ®æµ

```
1. getConnectedInputs(nodeId)
   â†“
2. ä»è¿æ¥çš„æºèŠ‚ç‚¹æå–æ•°æ®
   - image: data.image / data.outputImage
   - text: data.prompt / data.outputText
   â†“
3. éªŒè¯å¿…éœ€è¾“å…¥
   â†“
4. è°ƒç”¨ API æˆ–å¤„ç†é€»è¾‘
   â†“
5. updateNodeData(nodeId, result)
   â†“
6. æ•°æ®æµå‘ä¸‹æ¸¸èŠ‚ç‚¹
```

---

#### å›¾ç‰‡æ•°æ®æµ

```
ç”¨æˆ·ä¸Šä¼ /ç²˜è´´
   â†“
ImageInput èŠ‚ç‚¹ (data.image)
   â†“
[ä¿å­˜åˆ° IndexedDB]
   â†“
è¿æ¥åˆ°ä¸‹æ¸¸èŠ‚ç‚¹
   â†“
Annotation / Nano Banana
   â†“
è¾“å‡ºåˆ° data.outputImage
   â†“
[ä¿å­˜åˆ° IndexedDB]
   â†“
Output èŠ‚ç‚¹ / ä¸‹è½½
```

---

### æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ nodes/               # èŠ‚ç‚¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ BaseNode.tsx     # èŠ‚ç‚¹åŸºç±»
â”‚   â”‚   â”œâ”€â”€ ImageInputNode.tsx
â”‚   â”‚   â”œâ”€â”€ PromptNode.tsx
â”‚   â”‚   â”œâ”€â”€ NanoBananaNode.tsx
â”‚   â”‚   â”œâ”€â”€ AnnotationNode.tsx
â”‚   â”‚   â”œâ”€â”€ LLMGenerateNode.tsx
â”‚   â”‚   â”œâ”€â”€ SplitGridNode.tsx
â”‚   â”‚   â””â”€â”€ OutputNode.tsx
â”‚   â”œâ”€â”€ edges/               # è¾¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ EditableEdge.tsx
â”‚   â”‚   â””â”€â”€ ReferenceEdge.tsx
â”‚   â”œâ”€â”€ WorkflowCanvas.tsx   # ä¸»ç”»å¸ƒ
â”‚   â”œâ”€â”€ Header.tsx           # é¡¶éƒ¨å¯¼èˆª
â”‚   â”œâ”€â”€ FloatingActionBar.tsx # èŠ‚ç‚¹åˆ›å»ºå·¥å…·æ 
â”‚   â”œâ”€â”€ ConnectionDropMenu.tsx # è¿æ¥èœå•
â”‚   â”œâ”€â”€ MultiSelectToolbar.tsx # å¤šé€‰å·¥å…·æ 
â”‚   â”œâ”€â”€ EdgeToolbar.tsx      # è¾¹å·¥å…·æ 
â”‚   â”œâ”€â”€ GroupsOverlay.tsx    # åˆ†ç»„ç®¡ç†
â”‚   â”œâ”€â”€ GlobalImageHistory.tsx # å†å²è®°å½•
â”‚   â”œâ”€â”€ AnnotationModal.tsx  # æ ‡æ³¨ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ SplitGridSettingsModal.tsx # åˆ†å‰²è®¾ç½®
â”‚   â””â”€â”€ FeatureDocsModal.tsx # åŠŸèƒ½æ–‡æ¡£æŸ¥çœ‹å™¨
â”œâ”€â”€ store/
â”‚   â””â”€â”€ workflowStore.ts     # å…¨å±€çŠ¶æ€ç®¡ç†
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ imageCache.ts        # å›¾ç‰‡ç¼“å­˜
â”‚   â””â”€â”€ gridSplitter.ts      # ç½‘æ ¼åˆ†å‰²
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts             # ç±»å‹å®šä¹‰
â””â”€â”€ app/
    â”œâ”€â”€ api/
    â”‚   â”œâ”€â”€ generate/        # å›¾ç‰‡ç”Ÿæˆ API
    â”‚   â”œâ”€â”€ llm/             # æ–‡æœ¬ç”Ÿæˆ API
    â”‚   â”œâ”€â”€ workflow/        # å·¥ä½œæµä¿å­˜ API
    â”‚   â””â”€â”€ save-generation/ # å›¾ç‰‡ä¿å­˜ API
    â””â”€â”€ page.tsx             # ä¸»é¡µé¢
```

---

## ğŸ”§ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°èŠ‚ç‚¹ç±»å‹

å‚è€ƒ `CLAUDE.md` - "Adding New Node Types" ç« èŠ‚

**æ­¥éª¤**:
1. åœ¨ `src/types/index.ts` å®šä¹‰æ•°æ®æ¥å£
2. åœ¨ `workflowStore.ts` æ·»åŠ é»˜è®¤æ•°æ®
3. åˆ›å»ºèŠ‚ç‚¹ç»„ä»¶ï¼ˆç»§æ‰¿ `BaseNode`ï¼‰
4. åœ¨ `WorkflowCanvas.tsx` æ³¨å†ŒèŠ‚ç‚¹ç±»å‹
5. æ›´æ–° `ConnectionDropMenu.tsx`
6. æ·»åŠ æ‰§è¡Œé€»è¾‘åˆ° `executeWorkflow()`
7. æ›´æ–°æœ¬æ–‡æ¡£

---

### ä¿®æ”¹ä»£ç æ³¨æ„äº‹é¡¹

**æ ¸å¿ƒäº¤äº’é€»è¾‘** (é«˜é£é™©):
- ç©ºæ ¼é”®æ‹–åŠ¨: `WorkflowCanvas.tsx` - `spaceBarPressed` çŠ¶æ€
- èŠ‚ç‚¹æ‹–æ‹½ç¦ç”¨: `nodesDraggable={!spaceBarPressed}`
- ç¼©æ”¾é€»è¾‘: `handleWheel()` - åŒºåˆ† Cmd/Ctrl é”®
- è¿æ¥éªŒè¯: `isValidConnection()` - ç±»å‹åŒ¹é…è§„åˆ™

**æ•°æ®æµ** (ä¸­é£é™©):
- `getConnectedInputs()` - æ•°æ®æå–é€»è¾‘
- `executeWorkflow()` - æ‰§è¡Œé¡ºåºå’Œé”™è¯¯å¤„ç†
- `updateNodeData()` - å›¾ç‰‡ç¼“å­˜åŒæ­¥

**æŒä¹…åŒ–** (ä¸­é£é™©):
- æ–°èŠ‚ç‚¹åˆ›å»ºæ—¶æ¸…é™¤æ—§ç¼“å­˜ï¼ˆé˜²æ­¢ ID å†²çªï¼‰
- èŠ‚ç‚¹åˆ é™¤æ—¶æ¸…ç† IndexedDB
- LocalStorage å’Œ IndexedDB çš„æ•°æ®ä¸€è‡´æ€§

**å»ºè®®**:
- ä¿®æ”¹å‰é˜…è¯»æœ¬æ–‡æ¡£ç›¸å…³ç« èŠ‚
- å‚è€ƒç°æœ‰èŠ‚ç‚¹çš„å®ç°
- æµ‹è¯•ç©ºæ ¼é”®ã€ç¼©æ”¾ã€è¿æ¥ç­‰æ ¸å¿ƒäº¤äº’
- æ£€æŸ¥ IndexedDB ç¼“å­˜æ˜¯å¦æ­£ç¡®æ¸…ç†

---

**æ–‡æ¡£ç»´æŠ¤**: è¯·åœ¨æ·»åŠ æ–°åŠŸèƒ½ã€ä¿®æ”¹äº¤äº’é€»è¾‘æˆ–ä¿®å¤ bug æ—¶æ›´æ–°æœ¬æ–‡æ¡£ï¼

**æœ€åæ›´æ–°**: 2025-12-26
**ç»´æŠ¤è€…**: Claude + Willie
